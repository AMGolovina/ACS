# Отчет АКОС ИДЗ 4
Головина Арина БПИ244  

## Вариант 5
Задача о читателях и писателях. Базу данных, представленную массивом целых положительных чисел, разделяют два типа процессов: N читателей и K писателей. 
Читатели периодически просматривают случайные записи базы данных и выводят свой номер (например, PID), индекс записи, ее значение, а также вычисленное значение числа Фибоначчи. 
Писатели изменяют случайные записи на случайное число и также выводят информацию о своем номере, индексе записи, старом значении и новом значении. 
Предполагается, что в начале БД находится в непротиворечивом состоянии (все числа отсортированы, например, по возрастанию). 
Каждая отдельная новая запись переводит БД из одного непротиворечивого состояния в другое (то есть, новая сортировка может поменять индексы записей или переставить числа). 
Для предотвращения взаимного влияния транзакций процесс–писатель должен иметь исключительный доступ к БД. 
Если к БД не обращается ни один из процессов–писателей, то выполнять транзакции могут одновременно сколько угодно читателей.
Создать многопроцессное приложение с процессами-писателями и процессами-читателями.

---

## на 4-5 баллов
### 1. Общие требования:
Общие требования к программе сохранены:
1. База данных представлена массивом из 20 элементов последовательность от 1 до 20. Процесс-читатель берет рандомной элемент выводит его значение и число фибоначи для него, процесс-писатель меняет один рандомный элемент в массиве, затем выполняется сортировка чтобы привести массив в непротиворечивое состояние(числа по возрастанию).
2. Завершение с помощью Ctrl+C.
3. Число писателей и читателей задается с клавиатуры:
```
N = read_positive_int("Введите число читателей...")
K = read_positive_int("Введите число писателей...")
```
### 2. Сценарий:
Читатели периодически выбирают запись, считывают её значение и выполняют вычисление (число Фибоначчи), не изменяя базу. Писатели периодически выполняют транзакцию изменения: заменяют значение одной записи на новое и затем приводят базу к новому непротиворечивому состоянию (пересортировывают). Правило параллельности: при отсутствии активного писателя любое число читателей может работать одновременно, а при выполнении транзакции писатель имеет исключительный доступ, чтобы читатели не наблюдали промежуточное состояние.
### 3. Модель параллельных вычислений:
Одновременно работают независимые исполнители читатели и писатели. Чтения допускаются параллельно (несколько читателей одновременно), а операции записи выполняются только при полном исключении других операций с БД (писатель работает один). Ведётся учёт активных читателей, первый читатель блокирует возможность записи, последний читатель снимает блокировку; писатель перед транзакцией захватывает эксклюзивный доступ и освобождает его после завершения транзакции (изменение + восстановление согласованности). Таким образом обеспечивается отсутствие гонок данных и то, что читатель наблюдает только согласованные состояния базы, а запись является атомарной относительно других.
### 4. Входные данные:
Входными данными программы являются значения, вводимое пользователем с консоли количество процессов‑читателей N и процессов‑писателей K. Эти значения вводятся во время запуска и должны быть целыми положительными.
### 5. Семафоры и мьютексы:
`mutex` — cемафор, выполняет роль мьютекса для защиты счётчика читателей shared->read_count.
`rw_mutex` — семафор взаимного исключения для базы данных shared->db.
### 6. Ввод данных:
Реализован с консоли во впремя выполнения программы:
```
N = read_positive_int("Введите число читателей...")
K = read_positive_int("Введите число писателей...")
```
### 7. Генераторы случайных чисел:
`idx = rand() % DB_SIZE при DB_SIZE = 20` - индекс записи базы данных в диапазоне 0..19 (какую позицию читаем/изменяем).

`new_val = (rand() % 1000) + 1` - новое значение, записываемое писателем, в диапазоне 1..1000.

`fib_arg = value % 20` - аргумент для вычисления числа Фибоначчи.
### 8. Вывод программы:
Для процессак-читателя печатается: READER ... PID=... idx=... value=... fib=... — кто прочитал, какую запись, какое значение и какой результат вычисления Фибоначчи.

Для процесса-писателя печатается: WRITER ... PID=... idx=... old=... new=... — кто изменил, какую запись, старое и новое значение.
### 9. Коментарии:
В программе присутствуют комментарии, поясняющие выполняемые действия и описание используемых объектов и переменных.
### 10. Результаты работы:
<img width="571" height="375" alt="Снимок экрана 2025-12-14 в 23 36 23" src="https://github.com/user-attachments/assets/4b70ac07-843e-4049-a4c5-86e658ac8751" />

---
## на 6-7 баллов
### 1. Генерация случайных данных:
В программу добавлена генерация исходных данных базы данных случайными значениями в допустимых диапазонах. При запуске формируется начальное состояние БД: каждый элемент массива получает случайное значение `shared->db[i] = (rand() % 1000) + 1`(в диапазоне 1..1000), после чего выполняется сортировка массива, чтобы стартовое состояние было непротиворечивым.
### 2. Ввод исходных данных:
Реализован ввод исходных данных из командной строки при запуcке программы. В п.3 видно `./main 3 3`, где первая 3 - это количество читателей, вторая - писателей.
### 3. Результаты:
<img width="575" height="374" alt="Снимок экрана 2025-12-14 в 23 43 42" src="https://github.com/user-attachments/assets/fb997d07-b401-48a6-9d70-ba2b51b9f0e0" />


---
## на 8 баллов
### 1. Вывод в файл:
В программу добавлен вывод результатов работы не только в консоль, но и в файл журнала. Имя файла задаётся при запуске через параметр командной строки -o <имя_файла>, например: `./main -n 5 -k 3 -o out.log`.
### 2. Результаты работы:
Результаты работы программы выводятся на экран и записываются в файл.
### 3. Ввод из файла:
Наряду с вводом исходных данных через командную строку добав- лен альтернативный вариант их ввода из файла, который по сути играет роль конфигурационного файла. Имя этого файла задается в командной строке вместо параметров, которые в этом случае не вводятся. Управление вводом в командной строке осуществляется с использованием соответствующих ключей.
### 4. Три примера работы программы:
inp.txt - входной файл 

out1.log - выходной файл

<img width="573" height="375" alt="Снимок экрана 2025-12-15 в 01 17 55" src="https://github.com/user-attachments/assets/f38197e6-cba4-445c-8d00-fcd348566c32" />

out2.log - выходной файл

<img width="572" height="374" alt="Снимок экрана 2025-12-15 в 01 26 58" src="https://github.com/user-attachments/assets/7cbba785-cdd6-449b-845d-294855bfe94f" />

out3.log - выходной файл

<img width="571" height="374" alt="Снимок экрана 2025-12-15 в 01 29 06" src="https://github.com/user-attachments/assets/96e19d2b-df59-4401-902f-e3bc2b58fde1" />

### 5. Инструкция по сборке:

1. В папке с проектом нужно находится, в терминале собрать:
```
gcc main.c -o main
```
2. Запуск:
2.1. Входной файл:
```
./main -c <имя входного файла> -o <имя выходного файла>
```
2.2. Ввод читателей и писателей при запуске:

N - количество читателей 

K - количество писателей
```
./main -n N -k K -o <имя выходного файла>
```

---

## на 9-10 баллов

